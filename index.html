<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Studio Prompt v1.2</title>
  <meta name="description" content="NotebookLMã‚½ãƒ¼ã‚¹æ•´ç†æ–‡ã¨Studioç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç¬æ™‚ã«ä½œæˆã™ã‚‹ãƒ„ãƒ¼ãƒ«" />
  <!-- Google Fonts: Inter & Noto Sans JP -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  
  <style>
    :root {
      /* Colors - Fresh Theme */
      --bg-base: #f8fafc;
      --bg-grad-1: #e0f2fe; /* Light Sky */
      --bg-grad-2: #f0fdfa; /* Mint */
      
      --glass-bg: rgba(255, 255, 255, 0.75);
      --glass-border: rgba(255, 255, 255, 0.8);
      --glass-highlight: rgba(255, 255, 255, 0.9);
      --glass-shadow: rgba(148, 163, 184, 0.15); /* Colored soft shadow */
      
      --primary: #0ea5e9; /* Sky Blue */
      --primary-hover: #0284c7;
      --primary-light: #e0f2fe;
      
      --accent-slide: #8b5cf6; /* Violet */
      --accent-info: #06b6d4;  /* Cyan */
      
      --text-main: #334155; /* Slate 700 */
      --text-muted: #64748b; /* Slate 500 */
      --text-dim: #94a3b8;   /* Slate 400 */
      
      --input-bg: rgba(255, 255, 255, 0.6);
      --input-border: rgba(203, 213, 225, 0.6);
      --input-focus: rgba(255, 255, 255, 0.95);
      
      --success: #10b981;
      --danger: #ef4444;

      /* Spacing & Radius */
      --radius-lg: 24px; /* Rounder */
      --radius-md: 16px;
      --radius-sm: 10px;
      
      /* Fonts */
      --font-sans: 'Inter', 'Noto Sans JP', sans-serif;
      --font-mono: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--font-sans);
      background-color: var(--bg-base);
      /* Fresh Gradients */
      background-image: 
        radial-gradient(circle at 10% 10%, rgba(14, 165, 233, 0.12), transparent 40%),
        radial-gradient(circle at 90% 60%, rgba(139, 92, 246, 0.12), transparent 40%),
        linear-gradient(135deg, var(--bg-grad-1) 0%, var(--bg-grad-2) 100%);
      color: var(--text-main);
      height: 100vh;
      overflow: hidden;
      font-feature-settings: "palt";
    }

    /* Layout */
    .app-container {
      display: flex;
      flex-direction: column;
      height: 100%;
      max-width: 1440px;
      margin: 0 auto;
      padding: 24px;
      gap: 20px;
    }

    /* Header Layout - 3 Columns (Logo | Title | Controls) */
    .header {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      padding: 0 8px;
      gap: 16px;
    }

    /* Left: Logo */
    .header-left {
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }
    .logo-img {
      height: 50px; /* Adjust logo size */
      width: auto;
      object-fit: contain;
      /* If image fails, hide it and show text fallback if needed */
      display: block;
      /* Blend mode to make white background transparent */
      mix-blend-mode: multiply;
    }

    /* Center: Title */
    .header-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }
    .header-center h1 {
      font-size: 24px; 
      margin: 0; 
      font-weight: 700; 
      letter-spacing: -0.02em;
      color: var(--text-main);
    }
    .header-center p {
      font-size: 13px; 
      margin: 2px 0 0; 
      color: var(--text-muted);
      font-weight: 500;
      letter-spacing: 0.05em;
    }

    /* Right: Controls */
    .header-right {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Glass Card (White Frost) */
    .glass-panel {
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 
        0 4px 6px -1px rgba(0, 0, 0, 0.02),
        0 10px 15px -3px var(--glass-shadow);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    /* Main Grid */
    .main-grid {
      display: grid;
      grid-template-columns: 1fr 340px 1fr;
      gap: 24px;
      flex: 1;
      min-height: 0;
    }

    /* Column Headers - Fixed Height for Alignment */
    .panel-header {
      height: 68px;
      padding: 0 20px;
      border-bottom: 1px solid rgba(0,0,0,0.04);
      background: rgba(255, 255, 255, 0.4);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0; 
    }
    .panel-header h2 {
      margin: 0; font-size: 15px; font-weight: 600; color: var(--text-main);
      display: flex; align-items: center; gap: 10px;
    }
    /* Dot Indicators */
    .panel-header h2::before {
      content: ""; display: block; width: 8px; height: 8px; border-radius: 50%;
    }
    .col-1 h2::before { background: var(--success); box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.15); }
    .col-2 h2::before { background: var(--primary); box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.15); }
    .col-3 h2::before { background: var(--accent-slide); box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.15); }

    .panel-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    /* Form Elements */
    .form-group {
      display: flex; flex-direction: column; gap: 8px;
    }
    .label {
      font-size: 12px; color: var(--text-muted); font-weight: 600;
      display: flex; justify-content: space-between;
      letter-spacing: 0.02em;
    }
    .label span.optional { font-weight: 400; opacity: 0.7; }

    input, textarea, select {
      width: 100%;
      background: var(--input-bg);
      border: 1px solid var(--input-border);
      border-radius: var(--radius-md);
      padding: 14px;
      color: var(--text-main);
      font-family: var(--font-sans);
      font-size: 14px;
      transition: all 0.2s ease;
      outline: none;
      box-shadow: inset 0 1px 2px rgba(0,0,0,0.02);
    }
    input::placeholder, textarea::placeholder {
      color: var(--text-dim);
    }
    input:focus, textarea:focus, select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px var(--primary-light), inset 0 1px 2px rgba(0,0,0,0.02);
      background: var(--input-focus);
    }
    textarea {
      resize: none;
      min-height: 140px;
      line-height: 1.6;
    }
    
    /* Config Pills */
    .config-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .select-wrap { position: relative; }
    .select-wrap::after {
      content: "â–¼";
      position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
      font-size: 8px; color: var(--text-muted); pointer-events: none;
    }
    select { appearance: none; cursor: pointer; }

    /* Primary Action Buttons */
    .action-btn {
      width: 100%;
      padding: 18px;
      border: 1px solid transparent;
      border-radius: var(--radius-md);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      position: relative;
      overflow: hidden;
      color: white;
    }
    .action-btn strong { font-size: 15px; font-weight: 700; }
    .action-btn span { font-size: 11px; opacity: 0.9; font-weight: 500; }
    
    /* Info Button: Fresh Cyan/Blue */
    .btn-info {
      background: linear-gradient(135deg, #22d3ee, #0ea5e9);
      box-shadow: 0 4px 12px rgba(14, 165, 233, 0.25);
    }
    .btn-info:hover {
      box-shadow: 0 8px 20px rgba(14, 165, 233, 0.35);
      transform: translateY(-2px);
    }
    .btn-info.active {
      background: linear-gradient(135deg, #06b6d4, #0284c7);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
      transform: translateY(0);
    }

    /* Slide Button: Soft Violet */
    .btn-slide {
      background: linear-gradient(135deg, #a78bfa, #7c3aed);
      box-shadow: 0 4px 12px rgba(124, 58, 237, 0.25);
    }
    .btn-slide:hover {
      box-shadow: 0 8px 20px rgba(124, 58, 237, 0.35);
      transform: translateY(-2px);
    }
    .btn-slide.active {
      background: linear-gradient(135deg, #7c3aed, #6d28d9);
      box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
      transform: translateY(0);
    }

    /* Output Area */
    .output-area {
      background: #ffffff;
      border-radius: var(--radius-md);
      padding: 20px;
      font-family: var(--font-mono);
      font-size: 13px;
      line-height: 1.7;
      color: #1e293b;
      flex: 1;
      overflow-y: auto;
      border: 1px solid #e2e8f0;
      white-space: pre-wrap;
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.03);
    }
    
    /* Tabs */
    .tab-group {
      display: flex;
      background: rgba(0,0,0,0.05);
      padding: 5px;
      border-radius: var(--radius-md);
      gap: 5px;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 10px;
      font-size: 12px;
      border-radius: 12px;
      cursor: pointer;
      color: var(--text-muted);
      font-weight: 600;
      transition: all 0.2s;
    }
    .tab:hover { color: var(--text-main); background: rgba(255,255,255,0.5); }
    .tab.active {
      background: #ffffff;
      color: var(--primary);
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    /* History List */
    .history-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .history-item {
      padding: 12px 14px;
      border-radius: 12px;
      background: rgba(255,255,255,0.4);
      border: 1px solid rgba(255,255,255,0.6);
      cursor: pointer;
      transition: all 0.2s;
    }
    .history-item:hover {
      background: rgba(255,255,255,0.9);
      border-color: var(--primary-light);
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
      transform: translateX(2px);
    }
    .h-title { font-size: 13px; font-weight: 600; color: var(--text-main); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .h-meta { font-size: 11px; color: var(--text-dim); margin-top: 4px; display: flex; justify-content: space-between;}

    /* Utility Buttons */
    .btn-icon {
      background: transparent; border: none; color: var(--text-dim);
      cursor: pointer; padding: 6px; border-radius: 8px; transition: 0.2s;
    }
    .btn-icon:hover { background: rgba(0,0,0,0.05); color: var(--danger); }
    
    .btn-sm {
      font-size: 12px; padding: 8px 16px; border-radius: 10px;
      border: 1px solid transparent;
      background: rgba(255,255,255,0.5);
      color: var(--text-main);
      cursor: pointer;
      transition: 0.2s;
      font-weight: 500;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }
    .btn-sm:hover { background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.08); transform: translateY(-1px); }
    .btn-sm.primary {
      background: var(--primary); color: white;
      box-shadow: 0 2px 8px rgba(14, 165, 233, 0.3);
    }
    .btn-sm.primary:hover {
      background: var(--primary-hover);
      box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
    }

    /* Toast */
    .toast {
      position: fixed; top: 24px; left: 50%; transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 12px 24px;
      border-radius: 30px;
      border: 1px solid rgba(0,0,0,0.05);
      font-size: 13px;
      color: var(--text-main);
      font-weight: 500;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      z-index: 100;
      opacity: 0; pointer-events: none; transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform: translate(-50%, -20px);
    }
    .toast.show { opacity: 1; transform: translate(-50%, 0); }

    /* Cursor for typing effect */
    .typing-cursor::after {
      content: "â–‹";
      display: inline-block;
      vertical-align: bottom;
      animation: blink 1s step-end infinite;
      color: var(--primary);
    }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

    /* Footer Style */
    .footer {
      text-align: center;
      padding: 5px 0 0;
      font-size: 11px;
      color: var(--text-dim);
      opacity: 0.8;
      width: 100%;
    }

    /* Responsive */
    @media (max-width: 900px) {
      body { overflow: auto; height: auto; }
      .app-container { height: auto; padding: 16px; }
      .header { display: flex; flex-direction: column; gap: 12px; text-align: center; }
      .header-left, .header-center, .header-right { justify-content: center; width: 100%; }
      .main-grid { grid-template-columns: 1fr; display: flex; flex-direction: column; gap: 16px; }
      .glass-panel { min-height: auto; }
      textarea { min-height: 150px; }
      .output-area { min-height: 300px; }
      .controls-top { width: 100%; justify-content: center; }
    }
  </style>
</head>

<body>
  <div class="app-container">
    <!-- Header -->
    <header class="header">
      <!-- Left: Logo -->
      <div class="header-left">
        <img src="rogo.jpg" alt="SPC Logo" class="logo-img" onerror="this.style.display='none'">
      </div>

      <!-- Center: Title -->
      <div class="header-center">
        <h1>Studio Prompt</h1>
        <p>Creation Tool</p>
      </div>

      <!-- Right: Buttons -->
      <div class="header-right controls-top">
        <button class="btn-sm" id="btnSaveHistory">å±¥æ­´ã«ä¿å­˜</button>
        <button class="btn-sm" id="btnExport">JSONå‡ºåŠ›</button>
      </div>
    </header>

    <!-- Main Grid -->
    <div class="main-grid">
      
      <!-- COLUMN 1: INPUT -->
      <section class="glass-panel col-1">
        <div class="panel-header">
          <h2>1. å…ƒã®æƒ…å ±ã‚’å…¥åŠ›</h2>
          <button class="btn-icon" id="btnClearInput" title="ã‚¯ãƒªã‚¢">ğŸ—‘ï¸</button>
        </div>
        <div class="panel-body">
          <div class="form-group">
            <label class="label">è¦ç‚¹ãƒ†ã‚­ã‚¹ãƒˆ (å¿…é ˆ)</label>
            <textarea id="srcText" placeholder="ã“ã“ã«PDFã®è¦ç´„ã€è­°äº‹éŒ²ã€ãƒ¡ãƒ¢ãªã©ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„..."></textarea>
          </div>

          <div class="form-group">
            <label class="label">å‚ç…§URL <span class="optional">(ä»»æ„)</span></label>
            <input type="text" id="srcUrl" placeholder="https://..." />
          </div>
          
          <div style="margin-top:auto; padding-top:10px; border-top:1px solid rgba(0,0,0,0.05);">
            <p style="font-size:11px; color:var(--text-muted); line-height:1.5;">
              ğŸ’¡ <strong>Tips:</strong> ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«ã¯ã€Œç®‡æ¡æ›¸ãã€ã§ã‚‚ã€Œãƒ™ã‚¿æ‰“ã¡ã€ã§ã‚‚OKã€‚NotebookLMãŒç†è§£ã§ãã‚‹æƒ…å ±é‡ãŒã‚ã‚Œã°ååˆ†ã§ã™ã€‚
            </p>
          </div>
        </div>
      </section>

      <!-- COLUMN 2: CONFIG -->
      <section class="glass-panel col-2">
        <div class="panel-header">
          <h2>2. ç›®çš„ã¨è¨­å®š</h2>
        </div>
        <div class="panel-body">
          <!-- DATALIST DEFINITIONS -->
          <datalist id="titleList">
            <option value="DXå°å…¥ã‚¬ã‚¤ãƒ‰">
            <option value="æ¥­å‹™ãƒãƒ‹ãƒ¥ã‚¢ãƒ«">
            <option value="æ–°ã‚µãƒ¼ãƒ“ã‚¹ææ¡ˆæ›¸">
            <option value="å››åŠæœŸå ±å‘Šæ›¸">
            <option value="æ–°å…¥ç¤¾å“¡ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è³‡æ–™">
            <option value="è£½å“ã‚«ã‚¿ãƒ­ã‚°">
          </datalist>
          
          <datalist id="purposeList">
            <option value="é¡§å®¢ã¸ã®ææ¡ˆè³‡æ–™">
            <option value="ç¤¾å†…ç ”ä¿®ç”¨">
            <option value="çµŒå–¶ä¼šè­°ã§ã®å ±å‘Š">
            <option value="ã‚»ãƒŸãƒŠãƒ¼ç™»å£‡è³‡æ–™">
            <option value="ãƒ›ãƒ¯ã‚¤ãƒˆãƒšãƒ¼ãƒ‘ãƒ¼é…å¸ƒ">
            <option value="å–¶æ¥­ãƒ”ãƒƒãƒè³‡æ–™">
          </datalist>

          <div class="form-group">
            <label class="label">æ¡ˆä»¶å / ã‚¿ã‚¤ãƒˆãƒ«</label>
            <input type="text" id="projectTitle" placeholder="ä¾‹: DXå°å…¥ã‚¬ã‚¤ãƒ‰" list="titleList" />
          </div>
          
          <div class="form-group">
            <label class="label">ç”¨é€” / ã‚´ãƒ¼ãƒ«</label>
            <input type="text" id="purpose" placeholder="ä¾‹: é¡§å®¢ã¸ã®ææ¡ˆè³‡æ–™" list="purposeList" />
          </div>

          <div class="config-grid">
            <div class="form-group">
              <label class="label">å¯¾è±¡</label>
              <div class="select-wrap">
                <select id="audience">
                  <option value="ç¤¾å¤–å‘ã‘">ç¤¾å¤–å‘ã‘</option>
                  <option value="ç¤¾å†…å‘ã‘">ç¤¾å†…å‘ã‘</option>
                  <option value="åˆå¿ƒè€…">åˆå¿ƒè€…</option>
                  <option value="å°‚é–€å®¶">å°‚é–€å®¶</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="label">ãƒˆãƒ¼ãƒ³</label>
              <div class="select-wrap">
                <select id="tone">
                  <option value="ã‚„ã•ã—ã„">ã‚„ã•ã—ã„</option>
                  <option value="ãƒ“ã‚¸ãƒã‚¹">ãƒ“ã‚¸ãƒã‚¹</option>
                  <option value="è«–ç†çš„">è«–ç†çš„</option>
                  <option value="æƒ…ç†±çš„">æƒ…ç†±çš„</option>
                </select>
              </div>
            </div>
          </div>

          <!-- Color Selection -->
          <div class="config-grid">
             <div class="form-group">
              <label class="label">æ–‡å­—é‡</label>
              <div class="select-wrap">
                <select id="length">
                  <option value="æ¨™æº–">æ¨™æº–</option>
                  <option value="çŸ­ã‚">çŸ­ã‚ (è¦ç´„é‡è¦–)</option>
                  <option value="ã—ã£ã‹ã‚Š">ã—ã£ã‹ã‚Š (è©³ç´°é‡è¦–)</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label class="label">ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒ</label>
              <div class="select-wrap">
                <select id="colorTheme">
                  <option value="ãŠã¾ã‹ã›">ãŠã¾ã‹ã›</option>
                  <option value="ãƒ–ãƒ«ãƒ¼ç³»ï¼ˆä¿¡é ¼ãƒ»çŸ¥æ€§ï¼‰">ãƒ–ãƒ«ãƒ¼ç³»</option>
                  <option value="ã‚ªãƒ¬ãƒ³ã‚¸ç³»ï¼ˆå…ƒæ°—ãƒ»è¦ªã—ã¿ï¼‰">ã‚ªãƒ¬ãƒ³ã‚¸ç³»</option>
                  <option value="ã‚°ãƒªãƒ¼ãƒ³ç³»ï¼ˆå®‰å¿ƒãƒ»æˆé•·ï¼‰">ã‚°ãƒªãƒ¼ãƒ³ç³»</option>
                  <option value="ãƒ¢ãƒãƒˆãƒ¼ãƒ³ï¼ˆæ´—ç·´ï¼‰">ãƒ¢ãƒãƒˆãƒ¼ãƒ³</option>
                  <option value="ãƒ¬ãƒƒãƒ‰ç³»ï¼ˆæƒ…ç†±ãƒ»æ³¨æ„ï¼‰">ãƒ¬ãƒƒãƒ‰ç³»</option>
                </select>
              </div>
            </div>
          </div>

          <div style="margin: 6px 0;"></div>

          <!-- Action Buttons -->
          <div style="display:flex; flex-direction:column; gap:12px;">
            <button class="action-btn btn-info" id="btnInfo">
              <strong>ã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ç”Ÿæˆ</strong>
              <span>è¦ç‚¹ã‚’1æšçµµã®æ§‹æˆã«ã™ã‚‹</span>
            </button>
            <button class="action-btn btn-slide" id="btnSlide">
              <strong>ã‚¹ãƒ©ã‚¤ãƒ‰è³‡æ–™ç”Ÿæˆ</strong>
              <span>10æšå‰å¾Œã®ãƒ—ãƒ¬ã‚¼ãƒ³æ§‹æˆã«ã™ã‚‹</span>
            </button>
          </div>

          <!-- History Mini View -->
          <div style="margin-top:auto; flex:1; min-height:80px; display:flex; flex-direction:column;">
             <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
               <label class="label">æœ€è¿‘ã®å±¥æ­´</label>
               <button class="btn-icon" style="font-size:10px;" id="btnClearHistory">å…¨å‰Šé™¤</button>
             </div>
             <div class="history-list" id="history"></div>
          </div>
        </div>
      </section>

      <!-- COLUMN 3: OUTPUT -->
      <section class="glass-panel col-3">
        <div class="panel-header">
          <h2>3. ç”Ÿæˆçµæœ</h2>
          <div style="display:flex; gap:8px;">
            <button class="btn-sm" id="btnDownload">ä¿å­˜ (.txt)</button>
            <button class="btn-sm primary" id="btnCopy">ã‚³ãƒ”ãƒ¼</button>
          </div>
        </div>
        <div class="panel-body">
          <div class="tab-group">
            <div class="tab active" data-tab="nblm">NotebookLMç”¨</div>
            <div class="tab" data-tab="studio">Studioç”Ÿæˆç”¨</div>
          </div>
          
          <div class="output-area" id="output">
            <div style="color:var(--text-dim); text-align:center; padding-top:40px;">
              ä¸­å¤®ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦<br>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„
            </div>
          </div>
          
          <div style="font-size:11px; color:var(--text-muted); text-align:right;">
             <span id="status">æº–å‚™å®Œäº†</span>
          </div>
        </div>
      </section>

    </div>
    
    <!-- Footer -->
    <footer class="footer">
      ãƒ†ã‚¹ãƒˆç‰ˆï¼ˆãƒ™ãƒ¼ã‚¿ç‰ˆï¼‰ Â© 2026 SPC
    </footer>
  </div>

  <div class="toast" id="toast">Message</div>

  <script>
    const $ = (id) => document.getElementById(id);

    // --- Logic State ---
    const state = {
      mode: null,
      activeTab: "nblm",
      generatedAt: null,
      lastNblm: "",
      lastStudio: ""
    };

    // --- Utils ---
    const showToast = (msg) => {
      const t = $("toast");
      t.textContent = msg;
      t.classList.add("show");
      setTimeout(() => t.classList.remove("show"), 2000);
    };

    const safeText = (v) => (v || "").trim();
    const nowJP = () => {
      const d = new Date();
      return `${d.getMonth()+1}/${d.getDate()} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
    };

    // --- Typewriter Effect ---
    let typeInterval;
    const typeWriter = (text, element) => {
      element.innerHTML = "";
      element.classList.add("typing-cursor");
      
      if (typeInterval) clearInterval(typeInterval);

      if (text.length > 2000) {
        element.textContent = text;
        element.classList.remove("typing-cursor");
        return;
      }

      let i = 0;
      const speed = 2; 
      const batchSize = 5; 

      typeInterval = setInterval(() => {
        const chunk = text.slice(i, i + batchSize);
        element.textContent += chunk;
        i += batchSize;
        
        if (i >= text.length) {
          clearInterval(typeInterval);
          element.classList.remove("typing-cursor");
        }
      }, speed);
    };

    // --- Core Logic ---

    function buildSourceBlock(){
      const url = safeText($("srcUrl").value);
      const text = safeText($("srcText").value);
      
      const title = safeText($("projectTitle").value);
      const purpose = safeText($("purpose").value);
      
      const audience = $("audience").value;
      const tone = $("tone").value;
      const length = $("length").value;
      const colorTheme = $("colorTheme").value; 

      // Meta for NotebookLM
      const meta = [
        title ? `æ¡ˆä»¶åï¼š${title}` : "æ¡ˆä»¶åï¼šæœªå…¥åŠ›",
        purpose ? `ç”¨é€”ï¼š${purpose}` : "ç”¨é€”ï¼šæœªå…¥åŠ›",
        `å¯¾è±¡ï¼š${audience}`,
        `ãƒˆãƒ¼ãƒ³ï¼š${tone}`,
        `æ–‡å­—é‡ï¼š${length}`,
        `ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒï¼š${colorTheme}`,
        url ? `å‚ç…§URLï¼š${url}` : "å‚ç…§URLï¼šãªã—"
      ].join("\n");

      // Body Text
      const body = text ? text : "ï¼ˆãƒ†ã‚­ã‚¹ãƒˆæœªå…¥åŠ›ï¼‰";
      
      return { meta, body, title, purpose, audience, tone, length, url, colorTheme };
    }

    function templateNotebookLM(block){
      return `ä»¥ä¸‹ã®å†…å®¹ã‚’NotebookLMã®ã‚½ãƒ¼ã‚¹ã¨ã—ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

[ã‚½ãƒ¼ã‚¹ã®ç›®çš„]
ã“ã®è³‡æ–™ã¯ã€å†…å®¹ã‚’çŸ­æ™‚é–“ã§ç†è§£ã—ã€å¾Œç¶šã®ç”Ÿæˆï¼ˆã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ï¼ã‚¹ãƒ©ã‚¤ãƒ‰ï¼‰ã«å†åˆ©ç”¨ã§ãã‚‹å½¢ã«æ•´ãˆã‚‹ãŸã‚ã®ã‚½ãƒ¼ã‚¹ã§ã™ã€‚

[å…¥åŠ›ãƒ¡ã‚¿æƒ…å ±]
${block.meta}

[è¦ç‚¹æ•´ç†ã®æŒ‡é‡]
ãƒ»èƒŒæ™¯ï¼èª²é¡Œï¼ç¾çŠ¶
ãƒ»æä¾›ä¾¡å€¤ï¼ˆä½•ãŒè‰¯ããªã‚‹ã‹ï¼‰
ãƒ»å…·ä½“å†…å®¹ï¼ˆæ©Ÿèƒ½ã€æ‰‹é †ã€ç‰¹å¾´ã€æ•°å­—ï¼‰
ãƒ»æ´»ç”¨ã‚·ãƒ¼ãƒ³ï¼ˆèª°ãŒã€ã„ã¤ã€ã©ã“ã§ã€ã©ã†ä½¿ã†ã‹ï¼‰
ãƒ»æ³¨æ„ç‚¹ï¼åˆ¶ç´„ï¼ˆå¯¾è±¡å¤–ã€å‰ææ¡ä»¶ï¼‰

[ã‚½ãƒ¼ã‚¹æœ¬æ–‡]
${block.body}`;
    }

    function commonStudioPreamble(block){
      // Add color instruction specifically for Studio
      return `ä»¥ä¸‹ã®NotebookLMã‚½ãƒ¼ã‚¹ã‚’ã‚‚ã¨ã«æˆæœç‰©ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

[å‰æ]
${block.meta}
`;
    }

    function templateStudioInfographic(block){
      return `ã‚ãªãŸã¯æƒ…å ±æ•´ç†ãŒå¾—æ„ãªãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã§ã™ã€‚
${commonStudioPreamble(block)}

[ä½œã‚‹ã‚‚ã®]
ã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ï¼ˆ1æšã§å…¨ä½“åƒãŒåˆ†ã‹ã‚‹æ§‹æˆï¼‰

[ãƒ‡ã‚¶ã‚¤ãƒ³æŒ‡å®š]
ãƒ»ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ï¼š${block.colorTheme}

[æ§‹æˆãƒ«ãƒ¼ãƒ«]
ãƒ»æµã‚Œï¼šèƒŒæ™¯ â†’ èª²é¡Œ â†’ è§£æ±ºï¼ˆææ¡ˆ/æ–¹æ³•ï¼‰ â†’ æ´»ç”¨ï¼ˆè¡Œå‹•ï¼‰
ãƒ»å°‚é–€ç”¨èªã¯é¿ã‘ã€èª°ã§ã‚‚ç†è§£ã§ãã‚‹è¡¨ç¾ã«ã™ã‚‹
ãƒ»ç®‡æ¡æ›¸ãã®ç¾…åˆ—ã§ã¯ãªãã€è¦‹å‡ºã—ã”ã¨ã«ã¾ã¨ã¾ã‚Šã‚’ä½œã‚‹
ãƒ»é‡è¦ãƒã‚¤ãƒ³ãƒˆã¯æœ€å¤§7ã¤ã«åœ§ç¸®

[å‡ºåŠ›å½¢å¼]
ãƒ»ãƒ†ã‚­ã‚¹ãƒˆã§æ§‹æˆæ¡ˆã‚’æç¤ºï¼ˆè¦‹å‡ºã—ï¼‹è¦ç‚¹ï¼‰
ãƒ»æœ€å¾Œã«ã€Œä¸€è¨€ã‚­ãƒ£ãƒƒãƒã€ã‚’3æ¡ˆ
ãƒ»æœ€å¾Œã«ã€Œè¡Œå‹•ã®ä¸€æ­©ï¼ˆCTAï¼‰ã€ã‚’1æ–‡

[NotebookLMã‚½ãƒ¼ã‚¹]
ï¼ˆã“ã“ã«ã‚½ãƒ¼ã‚¹ãŒå…¥ã£ã¦ã„ã‚‹å‰æã§ä½œæˆï¼‰`;
    }

    function templateStudioSlides(block){
      return `ã‚ãªãŸã¯è³‡æ–™ä½œæˆã®ãƒ—ãƒ­ã§ã™ã€‚
${commonStudioPreamble(block)}

[ä½œã‚‹ã‚‚ã®]
ã‚¹ãƒ©ã‚¤ãƒ‰è³‡æ–™ï¼ˆå…¨ä½“10æšå‰å¾Œã€1ã‚¹ãƒ©ã‚¤ãƒ‰1ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰

[ãƒ‡ã‚¶ã‚¤ãƒ³æŒ‡å®š]
ãƒ»ãƒ¡ã‚¤ãƒ³ã‚«ãƒ©ãƒ¼ï¼š${block.colorTheme}

[æ§‹æˆãƒ«ãƒ¼ãƒ«]
ãƒ»åˆå¿ƒè€…ã«ã‚‚åˆ†ã‹ã‚‹èª¬æ˜é †ã«ã™ã‚‹
ãƒ»ã‚¿ã‚¤ãƒˆãƒ«ã¯çŸ­ãï¼ˆ12æ–‡å­—ç›®å®‰ï¼‰
ãƒ»æœ¬æ–‡ã¯è¦ç‚¹ã®ã¿ï¼ˆè©±ã™å†…å®¹ã¯åˆ¥ã«è£œè¶³ï¼‰
ãƒ»å¿…è¦ãªã‚‰å›³è§£æ¡ˆï¼ˆ1è¡Œï¼‰ã‚’æ·»ãˆã‚‹

[å‡ºåŠ›å½¢å¼]
ã‚¹ãƒ©ã‚¤ãƒ‰ç•ªå·ï¼ã‚¿ã‚¤ãƒˆãƒ«
ãƒ»è¡¨ç¤ºã™ã‚‹è¦ç‚¹ï¼ˆ2ã€œ4è¡Œï¼‰
ãƒ»è©±ã™å†…å®¹ï¼ˆ1ã€œ2è¡Œï¼‰
ãƒ»å›³è§£æ¡ˆï¼ˆä»»æ„ã€1è¡Œï¼‰

[æœ€å¾Œã«]
ãƒ»ã¾ã¨ã‚ï¼ˆ3è¡Œï¼‰
ãƒ»æ¬¡ã®ä¸€æ‰‹ï¼ˆCTAã€1è¡Œï¼‰

[NotebookLMã‚½ãƒ¼ã‚¹]
ï¼ˆã“ã“ã«ã‚½ãƒ¼ã‚¹ãŒå…¥ã£ã¦ã„ã‚‹å‰æã§ä½œæˆï¼‰`;
    }


    // --- Interaction ---

    function validateInputs(){
      const text = safeText($("srcText").value);
      if(!text){
        showToast("âš ï¸ è¦ç‚¹ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
        $("srcText").focus();
        return false;
      }
      return true;
    }

    function generate(mode){
      if(!validateInputs()) return;

      const block = buildSourceBlock();
      state.mode = mode;
      state.generatedAt = nowJP();

      state.lastNblm = templateNotebookLM(block);
      
      if(mode === "info"){
        state.lastStudio = templateStudioInfographic(block);
      } else {
        state.lastStudio = templateStudioSlides(block);
      }

      // Update UI
      renderOutput();
      updateButtonStates();
      showToast("âœ¨ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆå®Œäº†");
    }

    function updateButtonStates(){
      $("btnInfo").classList.toggle("active", state.mode === "info");
      $("btnSlide").classList.toggle("active", state.mode === "slide");
      $("status").textContent = `ç”Ÿæˆå®Œäº†: ${state.mode === "info" ? "ã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯" : "ã‚¹ãƒ©ã‚¤ãƒ‰"} (${state.generatedAt})`;
    }

    function renderOutput(){
      const out = $("output");
      const content = state.activeTab === "nblm" ? state.lastNblm : state.lastStudio;
      
      if(!content) {
        out.innerHTML = `<div style="color:var(--text-dim); text-align:center; padding-top:40px;">ä¸­å¤®ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦<br>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç”Ÿæˆã—ã¦ãã ã•ã„</div>`;
        return;
      }
      
      // Use Typewriter effect
      typeWriter(content, out);
    }

    function setActiveTab(tab){
      state.activeTab = tab;
      document.querySelectorAll(".tab").forEach(el => {
        el.classList.toggle("active", el.dataset.tab === tab);
      });
      renderOutput();
    }

    // --- History Logic ---
    const STORAGE_KEY = "SPF_HISTORY_V05"; 

    function loadHistory(){
      try{ return JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"); }
      catch(e){ return []; }
    }
    
    function renderHistory(){
      const box = $("history");
      const items = loadHistory();
      box.innerHTML = "";

      if(items.length === 0){
        box.innerHTML = `<div style="font-size:11px; color:var(--text-dim); text-align:center;">å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</div>`;
        return;
      }

      items.slice().reverse().forEach(it => {
        const el = document.createElement("div");
        el.className = "history-item";
        el.innerHTML = `
          <div class="h-title">${it.title || "No Title"}</div>
          <div class="h-meta">
            <span>${it.mode}</span>
            <span>${it.date}</span>
          </div>
        `;
        el.onclick = () => restoreHistory(it);
        box.appendChild(el);
      });
    }

    function saveCurrentToHistory(){
      if(!state.lastNblm) {
        showToast("âš ï¸ ä¿å­˜ã™ã‚‹å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }
      const items = loadHistory();
      const newItem = {
        id: Date.now(),
        date: nowJP(),
        mode: state.mode,
        inputs: {
          text: $("srcText").value,
          url: $("srcUrl").value,
          title: $("projectTitle").value,
          purpose: $("purpose").value,
          audience: $("audience").value,
          tone: $("tone").value,
          length: $("length").value,
          colorTheme: $("colorTheme").value
        },
        outputs: {
          nblm: state.lastNblm,
          studio: state.lastStudio
        }
      };
      // Keep max 10
      if(items.length > 9) items.shift();
      items.push(newItem);
      
      localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
      renderHistory();
      showToast("ğŸ’¾ å±¥æ­´ã«ä¿å­˜ã—ã¾ã—ãŸ");
    }

    function restoreHistory(it){
      $("srcText").value = it.inputs.text || "";
      $("srcUrl").value = it.inputs.url || "";
      $("projectTitle").value = it.inputs.title || "";
      $("purpose").value = it.inputs.purpose || "";
      $("audience").value = it.inputs.audience || "ç¤¾å¤–å‘ã‘";
      $("tone").value = it.inputs.tone || "ã‚„ã•ã—ã„";
      $("length").value = it.inputs.length || "æ¨™æº–";
      $("colorTheme").value = it.inputs.colorTheme || "ãŠã¾ã‹ã›";

      state.mode = it.mode;
      state.lastNblm = it.outputs.nblm;
      state.lastStudio = it.outputs.studio;
      state.generatedAt = it.date;

      setActiveTab("nblm");
      updateButtonStates();
      renderOutput();
      showToast("ğŸ“‚ å±¥æ­´ã‚’å¾©å…ƒã—ã¾ã—ãŸ");
    }

    // --- Events ---

    $("btnInfo").onclick = () => generate("info");
    $("btnSlide").onclick = () => generate("slide");

    document.querySelectorAll(".tab").forEach(el => {
      el.onclick = () => setActiveTab(el.dataset.tab);
    });

    $("btnCopy").onclick = () => {
      const content = state.activeTab === "nblm" ? state.lastNblm : state.lastStudio;
      if(!content) {
        showToast("âš ï¸ ã‚³ãƒ”ãƒ¼ã™ã‚‹å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“");
        return;
      }
      
      const textArea = document.createElement("textarea");
      textArea.value = content;
      
      textArea.style.position = "fixed";
      textArea.style.left = "-9999px";
      textArea.style.top = "0";
      document.body.appendChild(textArea);
      
      textArea.focus();
      textArea.select();
      
      try {
        const successful = document.execCommand('copy');
        if(successful) {
            showToast("âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
        } else {
            showToast("âŒ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
        }
      } catch (err) {
        showToast("âŒ ã‚¨ãƒ©ãƒ¼: ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸ");
        console.error('Copy error', err);
      }
      
      document.body.removeChild(textArea);
    };

    $("btnDownload").onclick = () => {
       const content = state.activeTab === "nblm" ? state.lastNblm : state.lastStudio;
       if(!content) return;
       const blob = new Blob([content], {type:"text/plain"});
       const url = URL.createObjectURL(blob);
       const a = document.createElement("a");
       a.href = url;
       a.download = `SPF_${$("projectTitle").value || "prompt"}.txt`;
       a.click();
       showToast("ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ");
    };

    $("btnClearInput").onclick = () => {
      $("srcText").value = "";
      $("srcUrl").value = "";
      $("projectTitle").value = "";
      $("purpose").value = "";
      showToast("ğŸ—‘ï¸ å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");
    };

    $("btnSaveHistory").onclick = saveCurrentToHistory;
    
    $("btnClearHistory").onclick = () => {
      if(confirm("å±¥æ­´ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){
        localStorage.removeItem(STORAGE_KEY);
        renderHistory();
        showToast("ğŸ—‘ï¸ å±¥æ­´ã‚’å‰Šé™¤ã—ã¾ã—ãŸ");
      }
    };
    
    $("btnExport").onclick = () => {
      const items = loadHistory();
      const blob = new Blob([JSON.stringify(items, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "spf_history.json";
      a.click();
    };

    // Init
    renderHistory();
  </script>
</body>
</html>